# CleanSightBackend é›†æˆæµ‹è¯•

å®Œæ•´çš„ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•å¥—ä»¶ï¼ŒéªŒè¯ä» RTMP ä¸Šä¼ åˆ°ä»»åŠ¡ç»ˆæ­¢çš„å®Œæ•´æµç¨‹ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
integration_tests/
â”œâ”€â”€ __init__.py                    # Python åŒ…æ ‡è¯†
â”œâ”€â”€ README.md                      # æœ¬æ–‡ä»¶
â”œâ”€â”€ test_full_pipeline.py          # ä¸»é›†æˆæµ‹è¯•è„šæœ¬
â”œâ”€â”€ utils.py                       # å·¥å…·å‡½æ•°ï¼ˆæ•°æ®åº“ã€ffmpegã€APIï¼‰
â””â”€â”€ client_viewer.py               # ç‹¬ç«‹çš„æ¨ç†ç»“æœå±•ç¤ºå®¢æˆ·ç«¯
```

## ğŸ¯ æµ‹è¯•ç›®æ ‡

é›†æˆæµ‹è¯•éªŒè¯ä»¥ä¸‹å®Œæ•´æµç¨‹ï¼š

1. **RTMP æ¨æµä¸Šä¼ **ï¼šé€šè¿‡ MediaMTX æ¨é€æœ¬åœ°æµ‹è¯•è§†é¢‘
2. **æ•°æ®åº“ä»»åŠ¡åŠ è½½**ï¼šä»æ•°æ®åº“åŠ è½½ task_id=0 çš„ä»»åŠ¡å¹¶å¯åŠ¨
3. **å®æ—¶ AI æ¨ç†**ï¼šåç«¯æ•è· RTMP æµå¹¶è¿›è¡Œ AI æ¨ç†
4. **WebSocket æ¨é€**ï¼šå®¢æˆ·ç«¯é€šè¿‡ WebSocket æ¥æ”¶æ¨ç†ç»“æœ
5. **HLS æ–‡ä»¶ä¿å­˜**ï¼šéªŒè¯ database ç›®å½•ä¸‹çš„è§†é¢‘æ®µå’Œå…³é”®ç‚¹æ–‡ä»¶
6. **ä»»åŠ¡ç»ˆæ­¢**ï¼šæ­£ç¡®ç»ˆæ­¢ä»»åŠ¡ï¼Œæ›´æ–°æ•°æ®åº“çŠ¶æ€ï¼Œé‡Šæ”¾èµ„æº

## ğŸ”§ å‰ç½®æ¡ä»¶

### 1. ç¯å¢ƒä¾èµ–
- **Python 3.8+** å’Œè™šæ‹Ÿç¯å¢ƒ `.venv`
- **MediaMTX** è¿è¡Œåœ¨ `localhost:1935`
- **åç«¯ API** è¿è¡Œåœ¨ `localhost:8000`
- **ffmpeg** å·²å®‰è£…ï¼ˆChocolatey æˆ–ç³»ç»Ÿ PATHï¼‰
- **æµ‹è¯•è§†é¢‘** å­˜åœ¨ï¼š`test/test_video.mp4`

### 2. å¯åŠ¨æœåŠ¡

**ç»ˆç«¯ 1: å¯åŠ¨ MediaMTX**
```powershell
cd mediamtx_v1.15.4
.\mediamtx.exe
```

**ç»ˆç«¯ 2: å¯åŠ¨åç«¯ API**
```powershell
.\.venv\Scripts\Activate.ps1
uvicorn app.main:app --reload
```

### 3. æ•°æ®åº“å‡†å¤‡

ç¡®ä¿æ•°æ®åº“ä¸­å­˜åœ¨ `task_id=0` çš„ä»»åŠ¡ï¼ˆæˆ–æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è¿è¡Œå®Œæ•´é›†æˆæµ‹è¯•

```powershell
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\.venv\Scripts\Activate.ps1

# è¿è¡Œæµ‹è¯•ï¼ˆé»˜è®¤ 30 ç§’ï¼‰
python integration_tests/test_full_pipeline.py

# è‡ªå®šä¹‰å‚æ•°
python integration_tests/test_full_pipeline.py --task_id 0 --duration 60 --client_id my_test
```

### å‚æ•°è¯´æ˜

- `--task_id`: è¦æµ‹è¯•çš„ä»»åŠ¡ IDï¼ˆé»˜è®¤: 0ï¼‰
- `--client_id`: å®¢æˆ·ç«¯æ ‡è¯†ç¬¦ï¼ˆé»˜è®¤: integration_test_clientï¼‰
- `--duration`: æµ‹è¯•æ—¶é•¿ç§’æ•°ï¼ˆé»˜è®¤: 30ï¼‰
- `--rtmp_url`: RTMP æ¨æµåœ°å€ï¼ˆé»˜è®¤: rtmp://localhost:1935/live/testï¼‰
- `--video_path`: æµ‹è¯•è§†é¢‘è·¯å¾„ï¼ˆé»˜è®¤: test/test_video.mp4ï¼‰

---

**æœ€åæ›´æ–°**: 2025-12-03
